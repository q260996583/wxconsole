<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="tbl_lottery_order" >
  <resultMap id="ibatorgenerated_BaseResultMap" class="com.jiuyv.yl.console.lottery.entity.TblLotteryOrder" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sat Oct 21 21:51:34 CST 2017.
    -->
    <result column="ID" property="id" jdbcType="INTEGER" />
    <result column="LOTTERY_ID" property="lotteryId" jdbcType="VARCHAR" />
    <result column="LOTTERY_TYPE" property="lotteryType" jdbcType="CHAR" />
    <result column="MERID" property="merid" jdbcType="VARCHAR" />
    <result column="STATUS" property="status" jdbcType="CHAR" />
    <result column="SYSTEM_TIME" property="systemTime" jdbcType="VARCHAR" />
    <result column="total_single_double" property="totalSingleDouble" jdbcType="VARCHAR" />
    <result column="total_big_small" property="totalBigSmall" jdbcType="VARCHAR" />
    <result column="total_tail_big_small" property="totalTailBigSmall" jdbcType="VARCHAR" />
    <result column="dragon_tigger" property="dragonTigger" jdbcType="VARCHAR" />
    <result column="leopard" property="leopard" jdbcType="VARCHAR" />
    <result column="field1" property="field1" jdbcType="VARCHAR" />
    <result column="field2" property="field2" jdbcType="VARCHAR" />
    <result column="field3" property="field3" jdbcType="VARCHAR" />
    <result column="field4" property="field4" jdbcType="VARCHAR" />
    <result column="field5" property="field5" jdbcType="VARCHAR" />
    <result column="win_amt" property="winAmt" jdbcType="INTEGER" />
    <result column="NICKNAME" property="nickname" jdbcType="VARCHAR" />
     <result column="trans_amt" property="transAmt" jdbcType="INTEGER" />
     <result column="msg_id" property="msgId" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="ibatorgenerated_Example_Where_Clause" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sat Oct 21 21:51:34 CST 2017.
    -->
    <iterate property="oredCriteria" conjunction="or" prepend="where" removeFirstPrepend="iterate" >
      <isEqual property="oredCriteria[].valid" compareValue="true" >
        (
        <iterate prepend="and" property="oredCriteria[].criteriaWithoutValue" conjunction="and" >
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithSingleValue" conjunction="and" >
          $oredCriteria[].criteriaWithSingleValue[].condition$
            #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithListValue" conjunction="and" >
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate property="oredCriteria[].criteriaWithListValue[].values" open="(" close=")" conjunction="," >
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue" conjunction="and" >
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
  <select id="ibatorgenerated_selectByExample" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.jiuyv.yl.console.lottery.entity.TblLotteryOrderExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sat Oct 21 21:51:34 CST 2017.
    -->
    select ID, LOTTERY_ID, LOTTERY_TYPE, od.MERID, STATUS, SYSTEM_TIME, total_single_double,
      total_big_small, total_tail_big_small, dragon_tigger, leopard, field1, field2, field3, field4,
      field5,win_amt,mer.NICKNAME,trans_amt,msg_id
    from tbl_lottery_order od
    left join tbl_webchant_merchant mer on od.MERID=mer.MERID
    <isParameterPresent >
      <include refid="tbl_lottery_order.ibatorgenerated_Example_Where_Clause" />
      <isNotNull property="orderByClause" >
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
  </select>
  <select id="ibatorgenerated_selectByPrimaryKey" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.jiuyv.yl.console.lottery.entity.TblLotteryOrder" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sat Oct 21 21:51:34 CST 2017.
    -->
    select ID, LOTTERY_ID, LOTTERY_TYPE, MERID, STATUS, SYSTEM_TIME, total_single_double,
      total_big_small, total_tail_big_small, dragon_tigger, leopard, field1, field2, field3, field4,
      field5,trans_amt,msg_id
    from tbl_lottery_order
    where ID = #id:INTEGER#
  </select>
  <delete id="ibatorgenerated_deleteByPrimaryKey" parameterClass="com.jiuyv.yl.console.lottery.entity.TblLotteryOrder" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sat Oct 21 21:51:34 CST 2017.
    -->
    delete from tbl_lottery_order
    where ID = #id:INTEGER#
  </delete>
  <delete id="ibatorgenerated_deleteByExample" parameterClass="com.jiuyv.yl.console.lottery.entity.TblLotteryOrderExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sat Oct 21 21:51:34 CST 2017.
    -->
    delete from tbl_lottery_order
    <include refid="tbl_lottery_order.ibatorgenerated_Example_Where_Clause" />
  </delete>
  <insert id="ibatorgenerated_insert" parameterClass="com.jiuyv.yl.console.lottery.entity.TblLotteryOrder" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sat Oct 21 21:51:34 CST 2017.
    -->
    insert into tbl_lottery_order (ID, LOTTERY_ID, LOTTERY_TYPE, MERID, STATUS, SYSTEM_TIME,
      total_single_double, total_big_small, total_tail_big_small, dragon_tigger, leopard, field1,
      field2, field3, field4, field5,trans_amt,msg_id)
    values (#id:INTEGER#, #lotteryId:VARCHAR#, #lotteryType:CHAR#, #merid:VARCHAR#, #status:CHAR#,
      #systemTime:VARCHAR#, #totalSingleDouble:VARCHAR#, #totalBigSmall:VARCHAR#,
      #totalTailBigSmall:VARCHAR#, #dragonTigger:VARCHAR#, #leopard:VARCHAR#, #field1:VARCHAR#,
      #field2:VARCHAR#, #field3:VARCHAR#, #field4:VARCHAR#, #field5:VARCHAR#, #transAmt:INTEGER#,#msgId:VARCHAR#)
  </insert>
  <insert id="ibatorgenerated_insertSelective" parameterClass="com.jiuyv.yl.console.lottery.entity.TblLotteryOrder" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sat Oct 21 21:51:34 CST 2017.
    -->
    insert into tbl_lottery_order
    <dynamic prepend="(" >
      <isNotNull prepend="," property="id" >
        ID
      </isNotNull>
      <isNotNull prepend="," property="lotteryId" >
        LOTTERY_ID
      </isNotNull>
      <isNotNull prepend="," property="lotteryType" >
        LOTTERY_TYPE
      </isNotNull>
      <isNotNull prepend="," property="merid" >
        MERID
      </isNotNull>
      <isNotNull prepend="," property="status" >
        STATUS
      </isNotNull>
      <isNotNull prepend="," property="systemTime" >
        SYSTEM_TIME
      </isNotNull>
      <isNotNull prepend="," property="totalSingleDouble" >
        total_single_double
      </isNotNull>
      <isNotNull prepend="," property="totalBigSmall" >
        total_big_small
      </isNotNull>
      <isNotNull prepend="," property="totalTailBigSmall" >
        total_tail_big_small
      </isNotNull>
      <isNotNull prepend="," property="dragonTigger" >
        dragon_tigger
      </isNotNull>
      <isNotNull prepend="," property="leopard" >
        leopard
      </isNotNull>
      <isNotNull prepend="," property="field1" >
        field1
      </isNotNull>
      <isNotNull prepend="," property="field2" >
        field2
      </isNotNull>
      <isNotNull prepend="," property="field3" >
        field3
      </isNotNull>
      <isNotNull prepend="," property="field4" >
        field4
      </isNotNull>
      <isNotNull prepend="," property="field5" >
        field5
      </isNotNull>
      <isNotNull prepend="," property="transAmt" >
        trans_Amt
      </isNotNull>
      <isNotNull prepend="," property="msgId" >
        msg_id
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(" >
      <isNotNull prepend="," property="id" >
        #id:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="lotteryId" >
        #lotteryId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="lotteryType" >
        #lotteryType:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="merid" >
        #merid:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="status" >
        #status:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="systemTime" >
        #systemTime:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="totalSingleDouble" >
        #totalSingleDouble:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="totalBigSmall" >
        #totalBigSmall:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="totalTailBigSmall" >
        #totalTailBigSmall:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="dragonTigger" >
        #dragonTigger:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="leopard" >
        #leopard:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="field1" >
        #field1:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="field2" >
        #field2:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="field3" >
        #field3:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="field4" >
        #field4:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="field5" >
        #field5:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="transAmt" >
        #transAmt:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="msgId" >
        #msgId:VARCHAR#
      </isNotNull>
      )
    </dynamic>
  </insert>
  <select id="ibatorgenerated_countByExample" parameterClass="com.jiuyv.yl.console.lottery.entity.TblLotteryOrderExample" resultClass="java.lang.Integer" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sat Oct 21 21:51:34 CST 2017.
    -->
    select count(*) from tbl_lottery_order
    <include refid="tbl_lottery_order.ibatorgenerated_Example_Where_Clause" />
  </select>
  <update id="ibatorgenerated_updateByExampleSelective" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sat Oct 21 21:51:34 CST 2017.
    -->
    update tbl_lottery_order
    <dynamic prepend="set" >
      <isNotNull prepend="," property="record.id" >
        ID = #record.id:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.lotteryId" >
        LOTTERY_ID = #record.lotteryId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.lotteryType" >
        LOTTERY_TYPE = #record.lotteryType:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.merid" >
        MERID = #record.merid:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.status" >
        STATUS = #record.status:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.systemTime" >
        SYSTEM_TIME = #record.systemTime:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.totalSingleDouble" >
        total_single_double = #record.totalSingleDouble:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.totalBigSmall" >
        total_big_small = #record.totalBigSmall:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.totalTailBigSmall" >
        total_tail_big_small = #record.totalTailBigSmall:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.dragonTigger" >
        dragon_tigger = #record.dragonTigger:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.leopard" >
        leopard = #record.leopard:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.field1" >
        field1 = #record.field1:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.field2" >
        field2 = #record.field2:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.field3" >
        field3 = #record.field3:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.field4" >
        field4 = #record.field4:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.field5" >
        field5 = #record.field5:VARCHAR#
      </isNotNull>
       <isNotNull prepend="," property="record.winAmt" >
        win_amt = #record.winAmt:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.transAmt" >
        trans_amt = #record.transAmt:INTEGER#
      </isNotNull>
    </dynamic>
    <isParameterPresent >
      <include refid="tbl_lottery_order.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sat Oct 21 21:51:34 CST 2017.
    -->
    update tbl_lottery_order
    set ID = #record.id:INTEGER#,
      LOTTERY_ID = #record.lotteryId:VARCHAR#,
      LOTTERY_TYPE = #record.lotteryType:CHAR#,
      MERID = #record.merid:VARCHAR#,
      STATUS = #record.status:CHAR#,
      SYSTEM_TIME = #record.systemTime:VARCHAR#,
      total_single_double = #record.totalSingleDouble:VARCHAR#,
      total_big_small = #record.totalBigSmall:VARCHAR#,
      total_tail_big_small = #record.totalTailBigSmall:VARCHAR#,
      dragon_tigger = #record.dragonTigger:VARCHAR#,
      leopard = #record.leopard:VARCHAR#,
      field1 = #record.field1:VARCHAR#,
      field2 = #record.field2:VARCHAR#,
      field3 = #record.field3:VARCHAR#,
      field4 = #record.field4:VARCHAR#,
      field5 = #record.field5:VARCHAR#
    <isParameterPresent >
      <include refid="tbl_lottery_order.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByPrimaryKeySelective" parameterClass="com.jiuyv.yl.console.lottery.entity.TblLotteryOrder" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sat Oct 21 21:51:34 CST 2017.
    -->
    update tbl_lottery_order
    <dynamic prepend="set" >
      <isNotNull prepend="," property="lotteryId" >
        LOTTERY_ID = #lotteryId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="lotteryType" >
        LOTTERY_TYPE = #lotteryType:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="merid" >
        MERID = #merid:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="status" >
        STATUS = #status:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="systemTime" >
        SYSTEM_TIME = #systemTime:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="totalSingleDouble" >
        total_single_double = #totalSingleDouble:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="totalBigSmall" >
        total_big_small = #totalBigSmall:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="totalTailBigSmall" >
        total_tail_big_small = #totalTailBigSmall:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="dragonTigger" >
        dragon_tigger = #dragonTigger:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="leopard" >
        leopard = #leopard:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="field1" >
        field1 = #field1:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="field2" >
        field2 = #field2:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="field3" >
        field3 = #field3:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="field4" >
        field4 = #field4:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="field5" >
        field5 = #field5:VARCHAR#
      </isNotNull>
    </dynamic>
    where ID = #id:INTEGER#
  </update>
  <update id="ibatorgenerated_updateByPrimaryKey" parameterClass="com.jiuyv.yl.console.lottery.entity.TblLotteryOrder" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sat Oct 21 21:51:34 CST 2017.
    -->
    update tbl_lottery_order
    set LOTTERY_ID = #lotteryId:VARCHAR#,
      LOTTERY_TYPE = #lotteryType:CHAR#,
      MERID = #merid:VARCHAR#,
      STATUS = #status:CHAR#,
      SYSTEM_TIME = #systemTime:VARCHAR#,
      total_single_double = #totalSingleDouble:VARCHAR#,
      total_big_small = #totalBigSmall:VARCHAR#,
      total_tail_big_small = #totalTailBigSmall:VARCHAR#,
      dragon_tigger = #dragonTigger:VARCHAR#,
      leopard = #leopard:VARCHAR#,
      field1 = #field1:VARCHAR#,
      field2 = #field2:VARCHAR#,
      field3 = #field3:VARCHAR#,
      field4 = #field4:VARCHAR#,
      field5 = #field5:VARCHAR#
    where ID = #id:INTEGER#
  </update>
  
   <select id="selectOrderGroupMerid" resultClass="com.jiuyv.yl.console.lottery.entity.TblLotteryOrder" >
      select sum(trans_amt) as transAmtSum, sum(trans_amt)*0.005 as transAmt, merid, NOW() as systemTime from tbl_lottery_order  
		where SYSTEM_TIME BETWEEN str_to_date(DATE_FORMAT(NOW(),'%Y-%m-%d'),'%Y-%m-%d %H:%i:%s')
		and DATE_ADD(DATE_ADD(str_to_date(DATE_FORMAT(NOW(),'%Y-%m-%d'),'%Y-%m-%d %H:%i:%s'),INTERVAL 1 DAY),INTERVAL -1 SECOND)
	group by merid
  </select>
  
  
   <select id="selectOrderByMsgId" parameterClass="com.jiuyv.yl.console.lottery.entity.TblLotteryOrder"
   resultClass="com.jiuyv.yl.console.lottery.entity.TblLotteryOrder" >
      select 
		sum(trans_amt) as transAmtSum,
    count(1) as count
	from tbl_lottery_order where 1=1
	  and merid = #merid# and status='00' and msg_id=#msgId#
  </select>
  
  
  <update id="cancleOrder" parameterClass="com.jiuyv.yl.console.lottery.entity.TblLotteryOrder">
    update tbl_lottery_order md set md.status='99' 
		where md.ID in(
		select id from (
		select ord.id from tbl_lottery_result r,tbl_lottery_order ord 
		where ord.LOTTERY_ID=r.LOTTERY_ID
		and ord.MERID=#merid# and NOW() <![CDATA[ < ]]> r.finish_time and ord.status='00' 
		and ord.msg_id=#msgId#) a)
  </update>
</sqlMap>